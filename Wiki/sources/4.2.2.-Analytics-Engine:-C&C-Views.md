# ANALYTICS ENGINE: COMPONENT AND CONNECTOR VIEWS

## Primary Presentation
![4.2.2.OLAP_Analytics_Engine_C&C_Views.png](../4.Views/4.2.2.OLAP_Analytics_Engine_C%26C_Views.png)

## Element Catalog

## Components
* **AnalyticsEngineController**: The controller receives the HTTP REST request from the clients, normally the `OpenLAPWebClient` macro component, but it's RESTful nature can also take request other client requests. The requests are then forwarded to the Service. The purpose of the Controller is to expose the external main methods of the macro component in a proxy fashion.
* **AnalyticsEngineService**: The heart of this macro component. The `AnalyticsEngineService` is responsible for checking the configurations to the triad components, executing and transforming query results and passing them to the Analytics Methods or Visualizations, creating instances of Analytics Methods, executing the Methods and/or passing the result to the visualizations, fetching the result (the HTML generated by the Visualizer) and forwarding it to the controller. The service interacts with multiple clients that allow it to mediate with the other macro components. This component realized the main flow of execution of the Analytics Engine which can be seen in the sub section [rationale](https://github.com/OpenLearningAnalyticsPlatform/OLAPArchitecture/wiki/4.2.2.-OLAP-Analytics-Engine:-C&C-Views#rationale).
* **IndicatorEngineAccessor**: An internal proxy client to the `IndicatorEngine` macro component via HTTP/REST. It is used mainly for getting access to the Indicators (and specifically the queries to execute).
* **&#60;&#60;MacroComponent&#62;&#62;IndicatorEngine**: The Indicator Engine explained in Section 4.3.
* **AnalyticsModulesAccessor**: An internal proxy client to the `AnalyticsModules` macro component, mainly providing an interface to save _triads_. Note that since the `AnalyticsModules` macro component resides in the same execution environment (JVM) as the `AnalyticsEngine` and the `AnalyticsMethods`.
* **&#60;&#60;MacroComponent&#62;&#62;AnalyticsModules**: The macro component explained in Section 4.6.
* **DataStoreAccessor**: An internal proxy client that helps the service access the `DataCollectionAndDataStore` macro module via HTTP/REST. In specific it allows the service to execute the queries and get the resultset to be passed to either Analytics Modules or directly a Visualization if no Analytics Module is selected.
* **&#60;&#60;MacroComponent&#62;&#62;DataCollectionAndDataStore**: The macro component explained in section 4.1.
* **VisualizerAccessor**: An internal proxy client to the Visualizer via HTTP/REST. It will be used by the `AnalyticsEngineService` to validate configurations and send requests for Visualizations along with the data fetched from the Data Collection and Data Store macro component or that is delivered as output of the Analytics Methods. The resulting HTML code will be then delivered to the client(s) trough the `AnalyticsEngineController`.
* **&#60;&#60;MacroComponent&#62;&#62;Visualizer**: The macro component explained in section 4.1.
* **AnalyticsMethodsAccessor**: An internal proxy client to the Analytics Methods. It enables the  `AnalyticsEngineService` to access the available Analytics Methods thus allowing for validation of configurations and execution with the data fetched from the Data Collection and Data Store macro component. Note that this differs somewhat to other access to external macro components The `AnalyticsEngineService` gets direct access to the instances of the Analytics Methods and executes them in the same environment.
* **&#60;&#60;MacroComponent&#62;&#62;AnalyticsMethods**: The macro component explained in section 4.5.
* **&#60;&#60;Abstract&#62;&#62;AbstractAnalyticsMethod**: This are the instances of the Analytics Methods, to which the data obtained from executing the queries that the Indicators wrap will. The `AnalyticsEngineService` uses the instances to validate the configurations and to execute the methods on the data. Then forwards the result to the Visualizer.
* **&#60;&#60;MacroComponent&#62;&#62;OpenLAPWebClient**: The macro component explained in section 4.7. It accesses the methods of the `AnalyticsEngineController` via HTTP/REST and displays is for the users via a web browser.

## Connectors
* **HTTP** Calls from `<<MacroComponent>>OpenLAPWebClient`:
* **HTTP** Calls to other `<<MacroComponent>>`: Note that the client components to external macro components i.e. `IndicatorEngine`, `AnalyticsModules`, `DataCollectionAndDataStorage` and `Visualizer` communicate through their own HTTP channel to the corresponding macro components. This means that they establish their own connections so the requests can be handled independently. It is up to the `AnalyticsEngineService` to guarantee the right flow to each one of the components.
* The calls to the `AnalyticsMethods` and the `AnalyticsModules` are don using direct access to those components, since the run environment is shared with the `AnalyticsEngine`.

## Context Diagram
![4.2.2.Context_Diagram.png](../4.Views/4.2.2.Context_Diagram.png)

## Variability Guide

* Whenever the user does not select an Analytics Method, and the configuration is valid, the `AnalyticsEngineService` will pass the collected data of the Indicator query result will be passed directly to the Visualization in the form of a `OLAPDataSet`.
* Some Analytics Methods could potentially communicate with external sources and services to perform their execution, this would mean that they also access outside components in their own protocols. The connections to those external services is allowed and is performed by the Analytics Method instances.

## Rationale

The Analytics Engine is the orchestration component and follows the following procedure for the execution of a triad:

1. The controller receives a request to execute a triad (alongside a configuration), which forwards to the service in the appropriate methods.
1. The service uses the clients to get the the Indicator, Analytics Method metadata and Visualizer Metadata required.
1. The service then checks that the configurations are valid for both the output of Indicator to the Analytics Method input and form the Analytics Method output to the Visualization input. For the Analytics Methods it uses the respective method directly for validation. In the case of the Visualizations, it access them through HTTP using the respective proxy.
1. If the configuration is valid, then executes the query of the Indiciator against the Data Collection and Data Storage macro component.
1. The result is converted to `OLAPDataSet` object and forwarded to the Analytics Method instrance. This is done locally, since the run time is the same.
1. The result of the analysis of the Analytics Method (also a `OLAPDataSet` object) is sent as a request to the Visualization for processing.
1. The Visualization returns the HTML code which is then returned to the controller.
Additionally, the Analytics Engine macro component should be able to filter based on both the Analytics Goal and fetch the input methods for suggestions when the user selects the Analytics Method and the Visualizations.

## Related Views
* Section 4.2.1 exposes the Module views of this macro component
* Section 4.1 explains the Data Collection and Data Storage
* Section 4.3 explains the Indicator engine
* Section 4.4 explains the Visualizer
* Section 4.5 explains the Analytics Methods
* Section 4.6 explains the Analytics Modules
